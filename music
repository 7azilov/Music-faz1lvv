<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ –ú—É–∑—ã–∫–∏</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram Mini App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∏–¥–∞ –≤ Telegram */
        body {
            background-color: var(--tg-theme-bg-color, #18222d);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        .search-input {
            background-color: var(--tg-theme-secondary-bg-color, #2a3b4c);
            border-color: var(--tg-theme-hint-color, #708499);
        }
        .search-button {
            background-color: var(--tg-theme-button-color, #5288c1);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .result-item {
            background-color: var(--tg-theme-secondary-bg-color, #2a3b4c);
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 max-w-lg">
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <header class="text-center my-6">
            <h1 class="text-3xl font-bold">üéµ –ü–æ–∏—Å–∫ –ú—É–∑—ã–∫–∏</h1>
            <p class="text-sm mt-1 opacity-70">–ù–∞–π–¥–∏—Ç–µ –ª—é–±–∏–º—ã–µ —Ç—Ä–µ–∫–∏</p>
        </header>

        <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
        <form id="search-form" class="flex items-center gap-2 mb-6">
            <input 
                type="text" 
                id="search-input"
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å..."
                class="search-input w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
            >
            <button 
                type="submit"
                class="search-button p-3 rounded-lg font-semibold transition hover:opacity-90"
            >
                –ù–∞–π—Ç–∏
            </button>
        </form>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
        <div id="results-container" class="space-y-3">
            <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loader" class="text-center py-10 hidden">
            <p>–ò–¥–µ—Ç –ø–æ–∏—Å–∫...</p>
        </div>
        
        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div id="message-container" class="text-center py-10 hidden">
            <p id="message-text"></p>
        </div>

    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        // –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É
        tg.expand();

        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const resultsContainer = document.getElementById('results-container');
        const loader = document.getElementById('loader');
        const messageContainer = document.getElementById('message-container');
        const messageText = document.getElementById('message-text');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        searchForm.addEventListener('submit', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const query = searchInput.value.trim();

            if (query) {
                searchMusic(query);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º—É–∑—ã–∫–∏ —á–µ—Ä–µ–∑ API Deezer —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º JSONP
        function searchMusic(query) {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
            resultsContainer.innerHTML = '';
            messageContainer.classList.add('hidden');
            loader.classList.remove('hidden');

            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è callback-—Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
            const callbackName = 'jsonp_callback_' + Date.now();

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º callback-—Ñ—É–Ω–∫—Ü–∏—é –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
            window[callbackName] = function(response) {
                loader.classList.add('hidden');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–µ—Ä–Ω—É–ª –ª–∏ API –æ—à–∏–±–∫—É
                if (response.error) {
                     console.error('–û—à–∏–±–∫–∞ API Deezer:', response.error);
                     showMessage(`–û—à–∏–±–∫–∞ API: ${response.error.message}`);
                } else if (response.data && response.data.length > 0) {
                    displayResults(response.data);
                } else {
                    showMessage('–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.');
                }

                // –û—á–∏—Å—Ç–∫–∞: —É–¥–∞–ª—è–µ–º —Ç–µ–≥ script –∏ callback-—Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
                document.body.removeChild(scriptElement);
                delete window[callbackName];
            };

            // –°–æ–∑–¥–∞–µ–º —Ç–µ–≥ script –¥–ª—è JSONP-–∑–∞–ø—Ä–æ—Å–∞
            const scriptElement = document.createElement('script');
            scriptElement.src = `https://api.deezer.com/search?q=${encodeURIComponent(query)}&output=jsonp&callback=${callbackName}`;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
            scriptElement.onerror = function() {
                loader.classList.add('hidden');
                showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
                
                // –û—á–∏—Å—Ç–∫–∞ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                if (document.body.contains(scriptElement)) {
                    document.body.removeChild(scriptElement);
                }
                delete window[callbackName];
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å
            document.body.appendChild(scriptElement);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function displayResults(tracks) {
            tracks.forEach(track => {
                const trackElement = document.createElement('div');
                trackElement.className = 'result-item flex items-center p-3 rounded-lg shadow-md transition hover:scale-105 cursor-pointer';
                
                trackElement.innerHTML = `
                    <img src="${track.album.cover_small}" alt="–û–±–ª–æ–∂–∫–∞ –∞–ª—å–±–æ–º–∞" class="w-16 h-16 rounded-md mr-4 object-cover">
                    <div class="flex-1 overflow-hidden">
                        <p class="font-bold truncate">${track.title}</p>
                        <p class="text-sm opacity-70 truncate">${track.artist.name}</p>
                    </div>
                    <div class="text-right text-sm opacity-70">
                        ${Math.floor(track.duration / 60)}:${(track.duration % 60).toString().padStart(2, '0')}
                    </div>
                `;
                
                // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç—Ä–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                trackElement.addEventListener('click', () => {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–∫–µ –±–æ—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
                    tg.sendData(JSON.stringify(track));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω–æ–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ Telegram
                    tg.showPopup({
                        title: '–¢—Ä–µ–∫ –≤—ã–±—Ä–∞–Ω',
                        message: `–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –±–æ—Ç—É —Ç—Ä–µ–∫: ${track.title} - ${track.artist.name}`,
                        buttons: [{type: 'ok'}]
                    });
                });

                resultsContainer.appendChild(trackElement);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (–æ—à–∏–±–∫–∏, –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
        function showMessage(text) {
            messageText.textContent = text;
            messageContainer.classList.remove('hidden');
        }

    </script>
</body>
</html>
